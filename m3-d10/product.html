<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="index.css">

    <title>Hello, world!</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg netflix-nav-bg">
        <a class="navbar-brand mx-4" href="#"><img src="netflix2.png" width="120"/></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
          <ul class="navbar-nav mr-auto mx-3mt-2 mt-lg-0">
              <li id="homeLink" class="nav-item active">
                <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">TV Shows</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Movies</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Recently Added</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">My List</a>
              </li>
            
          </ul mx-5>
          <ul class="navbar-nav mx-5 mt-2 mt-lg-0 form-inline">

              <li class="nav-item">

                <a id="searchBtn" class="nav-link btn px-1 py-1" data-toggle="collapse" href="#collapseExample" role="button"  aria-expanded="false" aria-controls="collapseExample">
                  <ion-icon name="search-outline" class="text-white"></ion-icon>
                </a>
               
              </li>
              <div class="collapse" id="collapseExample">
                <form class="form-inline my-sm-0">
                  <input class="form-control mr-sm-2" type="search" placeholder="Search">
                </form>
              </div>
              
              <!-- <div onclick="toggleSearch()">
                <ion-icon name="search-outline" class="text-white"></ion-icon>
                <input id="searchbar" type="search" class="d-none">
              </div> -->
              <li class="nav-item">
                <a class="nav-link" href="#">KIDS</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-bell"></i></a>
              </li>
              <div class="dropdown">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <img src="smiley1.png" width="30"/>
                </a>
              
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                  <a class="dropdown-item" href="#"><img src="smiley1.png" width="30"/>Profile1</a>
                  <a class="dropdown-item" href="#"><img src="smiley4.png" width="30"/>Profile2</a>
                  <a class="dropdown-item" href="account.html">Account</a>
                </div>
              </div>

              
          </ul>
        </div>
      </nav>
      <div class="container text-center my-4">
        <h1 id="title">Create Products</h1>
        <h2 id="subtitle">  Please fill up the form to create products</h2>
       <div class="row">
           <div class="col col-6 offset-md-3">
               <form onsubmit="createProducts(event)">
                  <div class="form-group">
                      <label for="name">Movie Name</label>
                      <input type="text" id="name" class="form-control" placeholder="write the product name">
                  </div>
                  <div class="form-group">
                      <label for="description">Desccription</label>
                      <textarea
                      type="text" id="description" class="form-control" placeholder="Please type to describe your product"
                      ></textarea>
                  </div>
                  <div class="form-group">
                    <div class="input-group mb-3">
                        <select class="custom-select" id="category">
                          <option selected>Genre</option>
                          <option value="Action">Action</option>
                          <option value="Comedy">Comedy</option>
                          <option value="Horror">Horror</option>
                          <option value="Thriller">Thriller</option>
                          <option value="Romance">Romance</option>
                          <option value="Fantasy">Fantasy</option>
                          <option value="Historical">Historical</option>
                        </select>
                        <div class="input-group-append">
                          <label class="input-group-text" for="inputGroupSelect02">Options</label>
                        </div>
                      </div>
                  </div>
                  <div class="form-group">
                      <label for="image">Movie image</label>
                      <input type="url" id="image" class="form-control" placeholder="write the product image">
                  </div>
                  
                  <div class="form-group">
                      <button class="btn btn-secondary" type="submit">
                       Submit Your Product
                      </button>
                  </div>
              </form>

           </div>
       </div>
          
          
        </div>
    </div>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
  <script>
        const link = "https://striveschool-api.herokuapp.com/api/movies/"
        let id
        window.onload = async () => {
            console.log("Iam here")
            let urlParams = new URLSearchParams(window.location.search);
            id = urlParams.get("id");
            if (id) {
                document.getElementById("title").innerText = 'Edit Your Products'
                document.getElementById("subtitle").innerText = "Think perfectly before editing, so that you wont f**ing come back and interrupt me"
                document.getElementById("submit").innerText = "Edit Your Product"
                document.getElementById("Delete").style.display = "block"
                let response = await fetch(link + id, {
                    headers: {
                        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMDY5NDg5YzI2ZjAwMTU3ZjljNDgiLCJpYXQiOjE2MTYxNTU0NDUsImV4cCI6MTYxNzM2NTA0NX0.iuCNU_eKVC66jM2Hlp0YhdVtAfn6-L2DPQCmDh0LaZ4"
                    }
                })
                let EditDetails = await response.json()
                document.getElementById("name").value = EditDetails.name
                document.getElementById("description").value = EditDetails.description
                document.getElementById("category").value = EditDetails.category
                document.getElementById("image").value = EditDetails.image
                

            } else {
                document.getElementById("title").innerText = "Create Products"
                document.getElementById("subtitle").innerText = "Please fill up the form to create product"
            }
        }
        
        const DeleteItem = async () => {
            let urlParams = new URLSearchParams(window.location.search);
            id = urlParams.get("id");
            try {
                let response = await fetch(link + id, {
                    method: 'DELETE',
                    //body:JSON.stringify(EditDetails),

                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMDY5NDg5YzI2ZjAwMTU3ZjljNDgiLCJpYXQiOjE2MTYxNTU0NDUsImV4cCI6MTYxNzM2NTA0NX0.iuCNU_eKVC66jM2Hlp0YhdVtAfn6-L2DPQCmDh0LaZ4"
                    },
                });
                if (response.ok) {
                    alert("event deleted successfully");
                    window.location.assign("index.html");
                } else {
                    alert("something went wrong with the deletion process");
                }
            } catch (error) {
                console.log(error)
            }
        }

        const createProducts = async (e) => {
            e.preventDefault()



            let myProducts = {
                name: document.getElementById("name").value,
                description: document.getElementById("description").value,
                category: document.getElementById("category").value,
                imageUrl: document.getElementById("image").value,
                
            }
            console.log(myProducts)

            let response;
            try {
                if (id) {
                    response = await fetch(link + id, {
                        method: 'PUT',
                        body: JSON.stringify(myProducts),
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMDY5NDg5YzI2ZjAwMTU3ZjljNDgiLCJpYXQiOjE2MTYxNTU0NDUsImV4cCI6MTYxNzM2NTA0NX0.iuCNU_eKVC66jM2Hlp0YhdVtAfn6-L2DPQCmDh0LaZ4"
                        },
                    });
                } else {
                    response = await fetch(link,{
                        method: 'POST',
                        body: JSON.stringify(myProducts),
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMDY5NDg5YzI2ZjAwMTU3ZjljNDgiLCJpYXQiOjE2MTYxNTU0NDUsImV4cCI6MTYxNzM2NTA0NX0.iuCNU_eKVC66jM2Hlp0YhdVtAfn6-L2DPQCmDh0LaZ4"
                        },
                    });
                }
                console.log(response)
                if (response.ok) {
                    // probably everything went well
                    alert(`Event was ${id ? "edited" : "created"}successfully!`);
                    window.location.assign("./index.html")
                } else {
                    alert("something went wrong :");
                    // probably something went wrong
                }
            } catch (error) {
                console.log(error);
            }

        }

    </script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
    -->
  </body>
</html>
